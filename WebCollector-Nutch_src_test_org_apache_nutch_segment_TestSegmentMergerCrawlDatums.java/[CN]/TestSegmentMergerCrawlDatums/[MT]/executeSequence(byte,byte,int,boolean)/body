{
  Path testDir=new Path(conf.get("hadoop.tmp.dir"),"merge-" + System.currentTimeMillis());
  DecimalFormat df=new DecimalFormat("0000000");
  Path[] segmentPaths=new Path[rounds];
  for (int i=0; i < rounds; i++) {
    String segmentName=df.format(i);
    segmentPaths[i]=new Path(testDir,segmentName);
  }
  createSegment(segmentPaths[0],firstStatus,false);
  for (int i=1; i < rounds - 1; i++) {
    byte status=(byte)(rnd.nextInt(6) + 0x21);
    boolean addRedirect=redirect ? rnd.nextBoolean() : false;
    boolean addFetch=addRedirect ? rnd.nextBoolean() : true;
    createSegment(segmentPaths[i],status,addFetch,addRedirect);
  }
  createSegment(segmentPaths[rounds - 1],lastStatus,true,redirect ? rnd.nextBoolean() : false);
  Path mergedSegment=merge(testDir,segmentPaths);
  return checkMergedSegment(testDir,mergedSegment);
}
