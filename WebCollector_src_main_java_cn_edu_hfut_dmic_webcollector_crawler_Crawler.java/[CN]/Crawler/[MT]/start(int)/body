{
  File dir=new File(crawlPath);
  boolean needInject=true;
  if (resumable && dir.exists()) {
    needInject=false;
  }
  if (resumable && !dir.exists()) {
    dir.mkdirs();
  }
  if (!resumable) {
    if (dir.exists()) {
      FileUtils.deleteDir(dir);
    }
    dir.mkdirs();
    if (seeds.isEmpty() && forcedSeeds.isEmpty()) {
      LOG.info("error:Please add at least one seed");
      return;
    }
  }
  EnvironmentConfig environmentConfig=new EnvironmentConfig();
  environmentConfig.setAllowCreate(true);
  env=new Environment(dir,environmentConfig);
  if (needInject) {
    inject();
  }
  if (!forcedSeeds.isEmpty()) {
    injectForcedSeeds();
  }
  status=RUNNING;
  for (int i=0; i < depth; i++) {
    if (status == STOPED) {
      break;
    }
    LOG.info("starting depth " + (i + 1));
    long startTime=System.currentTimeMillis();
    StandardGenerator generator=new StandardGenerator(env);
    generator.setTopN(topN);
    fetcher=new Fetcher();
    fetcher.setHttpRequester(httpRequester);
    fetcher.setDbUpdater(new DbUpdater(env));
    fetcher.setVisitorFactory(visitorFactory);
    fetcher.setRetry(retry);
    fetcher.setThreads(threads);
    fetcher.fetchAll(generator);
    long endTime=System.currentTimeMillis();
    long costTime=(endTime - startTime) / 1000;
    int totalGenerate=generator.getTotalGenerate();
    LOG.info("depth " + (i + 1) + " finish: \n\tTOTAL urls:\t"+ totalGenerate+ "\n\tTOTAL time:\t"+ costTime+ " seconds");
    if (totalGenerate == 0) {
      break;
    }
  }
  env.close();
}
