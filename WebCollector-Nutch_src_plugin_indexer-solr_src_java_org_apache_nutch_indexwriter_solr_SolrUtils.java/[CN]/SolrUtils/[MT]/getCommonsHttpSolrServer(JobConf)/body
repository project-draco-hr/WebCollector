{
  HttpClient client=new HttpClient();
  if (job.getBoolean(SolrConstants.USE_AUTH,false)) {
    String username=job.get(SolrConstants.USERNAME);
    LOG.info("Authenticating as: " + username);
    AuthScope scope=new AuthScope(AuthScope.ANY_HOST,AuthScope.ANY_PORT,AuthScope.ANY_REALM,AuthScope.ANY_SCHEME);
    client.getState().setCredentials(scope,new UsernamePasswordCredentials(username,job.get(SolrConstants.PASSWORD)));
    HttpClientParams params=client.getParams();
    params.setAuthenticationPreemptive(true);
    client.setParams(params);
  }
  String serverURL=job.get(SolrConstants.SERVER_URL);
  return new CommonsHttpSolrServer(serverURL,client);
}
