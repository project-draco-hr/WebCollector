{
  if (defaultUsername != null && defaultUsername.length() > 0) {
    int port=url.getPort();
    if (port == -1) {
      if ("https".equals(url.getProtocol()))       port=443;
 else       port=80;
    }
    AuthScope scope=new AuthScope(url.getHost(),port);
    if (client.getState().getCredentials(scope) != null) {
      if (LOG.isTraceEnabled())       LOG.trace("Pre-configured credentials with scope - host: " + url.getHost() + "; port: "+ port+ "; found for url: "+ url);
      return;
    }
    if (LOG.isTraceEnabled())     LOG.trace("Pre-configured credentials with scope -  host: " + url.getHost() + "; port: "+ port+ "; not found for url: "+ url);
    AuthScope serverAuthScope=getAuthScope(url.getHost(),port,defaultRealm,defaultScheme);
    NTCredentials serverCredentials=new NTCredentials(defaultUsername,defaultPassword,agentHost,defaultRealm);
    client.getState().setCredentials(serverAuthScope,serverCredentials);
  }
}
