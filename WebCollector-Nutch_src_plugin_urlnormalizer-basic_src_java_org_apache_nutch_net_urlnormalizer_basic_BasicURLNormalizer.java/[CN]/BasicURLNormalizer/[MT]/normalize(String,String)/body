{
  if ("".equals(urlString))   return urlString;
  urlString=urlString.trim();
  URL url=new URL(urlString);
  String protocol=url.getProtocol();
  String host=url.getHost();
  int port=url.getPort();
  String file=url.getFile();
  boolean changed=false;
  if (!urlString.startsWith(protocol))   changed=true;
  if ("http".equals(protocol) || "https".equals(protocol) || "ftp".equals(protocol)) {
    if (host != null) {
      String newHost=host.toLowerCase();
      if (!host.equals(newHost)) {
        host=newHost;
        changed=true;
      }
    }
    if (port == url.getDefaultPort()) {
      port=-1;
      changed=true;
    }
    if (file == null || "".equals(file)) {
      file="/";
      changed=true;
    }
    if (url.getRef() != null) {
      changed=true;
    }
    String file2=substituteUnnecessaryRelativePaths(file);
    if (!file.equals(file2)) {
      changed=true;
      file=file2;
    }
  }
  if (changed)   urlString=new URL(protocol,host,port,file).toString();
  return urlString;
}
