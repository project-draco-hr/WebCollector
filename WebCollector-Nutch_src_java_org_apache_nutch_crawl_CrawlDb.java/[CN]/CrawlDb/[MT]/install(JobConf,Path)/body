{
  boolean preserveBackup=job.getBoolean("db.preserve.backup",true);
  Path newCrawlDb=FileOutputFormat.getOutputPath(job);
  FileSystem fs=new JobClient(job).getFs();
  Path old=new Path(crawlDb,"old");
  Path current=new Path(crawlDb,CURRENT_NAME);
  if (fs.exists(current)) {
    if (fs.exists(old))     fs.delete(old,true);
    fs.rename(current,old);
  }
  fs.mkdirs(crawlDb);
  fs.rename(newCrawlDb,current);
  if (!preserveBackup && fs.exists(old))   fs.delete(old,true);
  Path lock=new Path(crawlDb,LOCK_NAME);
  LockUtil.removeLockFile(fs,lock);
}
