{
  if (segmentName == null) {
    segmentName=getLastSegmentName();
  }
  if (segmentName == null) {
    return;
  }
  LogUtils.getLogger().info("merge " + getSegmentPath());
  mergeCount=0;
  File file_fetch=new File(getSegmentPath(),"fetch/info.avro");
  if (!file_fetch.exists()) {
    return;
  }
  File file_current=new File(crawlPath,Config.current_info_path);
  DbReader<CrawlDatum> reader_current=new DbReader<CrawlDatum>(CrawlDatum.class,file_current);
  DbReader<CrawlDatum> reader_fetch=new DbReader<CrawlDatum>(CrawlDatum.class,file_fetch);
  File file_new=new File(crawlPath,Config.new_info_path);
  if (!file_new.getParentFile().exists()) {
    file_new.getParentFile().mkdirs();
  }
  DbWriter<CrawlDatum> writer=new DbWriter<CrawlDatum>(CrawlDatum.class,file_new);
  BloomFilter bloomFilter=new BloomFilter();
  CrawlDatum datum=null;
  while (reader_fetch.hasNext()) {
    datum=reader_fetch.readNext();
    bloomFilter.add(datum.getUrl());
    writer.write(datum);
    reportMergeCount();
  }
  reader_fetch.close();
  while (reader_current.hasNext()) {
    datum=reader_current.readNext();
    if (bloomFilter.contains(datum.getUrl())) {
      continue;
    }
    bloomFilter.add(datum.getUrl());
    writer.write(datum);
    reportMergeCount();
  }
  reader_current.close();
  File file_parse=new File(getSegmentPath(),"parse_data/info.avro");
  if (file_parse.exists()) {
    DbReader<ParseData> reader_parse=new DbReader<ParseData>(ParseData.class,file_parse);
    ParseData parseresult=null;
    while (reader_parse.hasNext()) {
      parseresult=reader_parse.readNext();
      for (      Link link : parseresult.getLinks()) {
        if (bloomFilter.contains(link.getUrl())) {
          continue;
        }
        datum=new CrawlDatum();
        datum.setUrl(link.getUrl());
        datum.setStatus(CrawlDatum.STATUS_DB_UNFETCHED);
        bloomFilter.add(datum.getUrl());
        writer.write(datum);
        reportMergeCount();
      }
    }
    reader_parse.close();
  }
  writer.close();
  install();
}
