{
  fActivatedPlugins=new HashMap<String,Plugin>();
  fExtensionPoints=new HashMap<String,ExtensionPoint>();
  this.conf=new Configuration(conf);
  this.auto=conf.getBoolean("plugin.auto-activation",true);
  String[] pluginFolders=conf.getStrings("plugin.folders");
  PluginManifestParser manifestParser=new PluginManifestParser(this.conf,this);
  Map<String,PluginDescriptor> allPlugins=manifestParser.parsePluginFolder(pluginFolders);
  if (allPlugins.isEmpty()) {
    LOG.warn("No plugins found on paths of property plugin.folders=\"{}\"",conf.get("plugin.folders"));
  }
  Pattern excludes=Pattern.compile(conf.get("plugin.excludes",""));
  Pattern includes=Pattern.compile(conf.get("plugin.includes",""));
  Map<String,PluginDescriptor> filteredPlugins=filter(excludes,includes,allPlugins);
  fRegisteredPlugins=getDependencyCheckedPlugins(filteredPlugins,this.auto ? allPlugins : filteredPlugins);
  installExtensionPoints(fRegisteredPlugins);
  try {
    installExtensions(fRegisteredPlugins);
  }
 catch (  PluginRuntimeException e) {
    LOG.error(e.toString());
    throw new RuntimeException(e.getMessage());
  }
  displayStatus();
}
