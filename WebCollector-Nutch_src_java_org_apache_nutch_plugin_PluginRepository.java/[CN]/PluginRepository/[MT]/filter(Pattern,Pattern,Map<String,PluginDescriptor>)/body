{
  Map<String,PluginDescriptor> map=new HashMap<String,PluginDescriptor>();
  if (plugins == null) {
    return map;
  }
  for (  PluginDescriptor plugin : plugins.values()) {
    if (plugin == null) {
      continue;
    }
    String id=plugin.getPluginId();
    if (id == null) {
      continue;
    }
    if (!includes.matcher(id).matches()) {
      LOG.debug("not including: " + id);
      continue;
    }
    if (excludes.matcher(id).matches()) {
      LOG.debug("excluding: " + id);
      continue;
    }
    map.put(plugin.getPluginId(),plugin);
  }
  return map;
}
