{
  boolean abort=false;
  NodeWalker walker=new NodeWalker(node);
  while (walker.hasNext()) {
    Node currentNode=walker.nextNode();
    String nodeName=currentNode.getNodeName();
    short nodeType=currentNode.getNodeType();
    if ("script".equalsIgnoreCase(nodeName)) {
      walker.skipChildren();
    }
    if ("style".equalsIgnoreCase(nodeName)) {
      walker.skipChildren();
    }
    if (abortOnNestedAnchors && "a".equalsIgnoreCase(nodeName)) {
      anchorDepth++;
      if (anchorDepth > 1) {
        abort=true;
        break;
      }
    }
    if (nodeType == Node.COMMENT_NODE) {
      walker.skipChildren();
    }
    if (nodeType == Node.TEXT_NODE) {
      String text=currentNode.getNodeValue();
      text=text.replaceAll("\\s+"," ");
      text=text.trim();
      if (text.length() > 0) {
        if (sb.length() > 0)         sb.append(' ');
        sb.append(text);
      }
    }
  }
  return abort;
}
