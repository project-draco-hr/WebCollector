{
  clusterName=job.get(ElasticConstants.CLUSTER);
  host=job.get(ElasticConstants.HOST);
  port=job.getInt(ElasticConstants.PORT,9300);
  Builder settingsBuilder=ImmutableSettings.settingsBuilder().classLoader(Settings.class.getClassLoader());
  BufferedReader reader=new BufferedReader(job.getConfResourceAsReader("elasticsearch.conf"));
  String line;
  String parts[];
  while ((line=reader.readLine()) != null) {
    if (StringUtils.isNotBlank(line) && !line.startsWith("#")) {
      line.trim();
      parts=line.split("=");
      if (parts.length == 2) {
        settingsBuilder.put(parts[0].trim(),parts[1].trim());
      }
    }
  }
  if (StringUtils.isNotBlank(clusterName))   settingsBuilder.put("cluster.name",clusterName);
  Settings settings=settingsBuilder.build();
  if (host != null && port > 1) {
    client=new TransportClient(settings).addTransportAddress(new InetSocketTransportAddress(host,port));
  }
 else   if (clusterName != null) {
    node=nodeBuilder().settings(settings).client(true).node();
    client=node.client();
  }
  bulk=client.prepareBulk();
  defaultIndex=job.get(ElasticConstants.INDEX,"nutch");
  maxBulkDocs=job.getInt(ElasticConstants.MAX_BULK_DOCS,DEFAULT_MAX_BULK_DOCS);
  maxBulkLength=job.getInt(ElasticConstants.MAX_BULK_LENGTH,DEFAULT_MAX_BULK_LENGTH);
}
