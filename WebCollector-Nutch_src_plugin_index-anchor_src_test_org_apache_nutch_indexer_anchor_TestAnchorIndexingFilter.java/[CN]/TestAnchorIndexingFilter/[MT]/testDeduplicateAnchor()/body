{
  Configuration conf=NutchConfiguration.create();
  conf.setBoolean("anchorIndexingFilter.deduplicate",true);
  AnchorIndexingFilter filter=new AnchorIndexingFilter();
  filter.setConf(conf);
  Assert.assertNotNull(filter);
  NutchDocument doc=new NutchDocument();
  ParseImpl parse=new ParseImpl("foo bar",new ParseData());
  Inlinks inlinks=new Inlinks();
  inlinks.add(new Inlink("http://test1.com/","text1"));
  inlinks.add(new Inlink("http://test2.com/","text2"));
  inlinks.add(new Inlink("http://test3.com/","text2"));
  try {
    filter.filter(doc,parse,new Text("http://nutch.apache.org/index.html"),new CrawlDatum(),inlinks);
  }
 catch (  Exception e) {
    e.printStackTrace();
    Assert.fail(e.getMessage());
  }
  Assert.assertNotNull(doc);
  Assert.assertTrue("test if there is an anchor at all",doc.getFieldNames().contains("anchor"));
  Assert.assertEquals("test dedup, we expect 2",2,doc.getField("anchor").getValues().size());
}
